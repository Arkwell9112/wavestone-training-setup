---

- name: Check Playbook if AWX installation is running.
  hosts: gcp_category_awx
  become: yes

  tasks:
    - name: Check AWX running.
      shell: >
        {% raw %} kubectl get svc -n awx -o go-template='{{range .items}}{{range.spec.ports}}{{if .nodePort}}{{.nodePort}}{{"\n"}}{{end}}{{end}}{{end}}' {% endraw %}
      register: awxCheck

    - name: Debug AWX running.
      debug:
        msg: "{{ awxCheck.stdout }}"

    - name: Check AWX IP.
      shell: terraform output awx-vm-ip
      register: awxIP
      delegate_to: localhost

    - name: Debug AWX IP.
      debug:
        msg: "{{ awxIP.stdout }}"
